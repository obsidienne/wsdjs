<main class="container">
  <div class="row">
    <div class="col-xs-12">
      <%= if @current_user && @current_user.id == @top.user_id do %>
        <%= render "_steps.html", conn: @conn, top: @top, changeset: @changeset %>
      <% end %>

      <h3>
        TOP 10, <time datetime="<%= Date.to_iso8601(@top.due_date) %>"></time>
        <small><%= @top.status %></small>
      </h3>

      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Cover</th>
            <th>Song</th>
            <th>Points</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tbody>
            <%= for rank <- @top.ranks do %>
            <tr>
              <td>
                <a class="text-muted" target="_blank" href="<%= rank.song.url %>">
                  <img height="60" width="60" class="cld-responsive" src="<%= song_art_href_default()%>" data-src="<%= song_art_href(rank.song.art)%>" />
                </a>
              </td>
              <td>
                <div>
                  <%= link to: song_path(@conn, :show, rank.song) do %>
                  <%= rank.song.title %> - <%= rank.song.artist %>
                  <% end %>
                </div>
                <span class="label label-default"><%= rank.song.genre %></span>
                <%= if rank.song.bpm > 0 do %>
                <span class="label label-primary"><%= rank.song.bpm %> bpm</span>
                <% end %>
              </td>
              <td class="counting-points" data-points="<%= rank.votes + rank.likes %>" data-bonus="<%= rank.bonus %>"><%= rank.votes + rank.likes %> + <%= rank.bonus %></td>
            </tr>
            <% end %>
        </tbody>
      </table>
    </div>

    </div>
  </div>
</main>
